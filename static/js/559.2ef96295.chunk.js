"use strict";(self.webpackChunkfov_map=self.webpackChunkfov_map||[]).push([[559],{9559:function(e,t,r){r.r(t),r.d(t,{default:function(){return b}});var n=r(1413),i=r(9439),o=r(2791),a=r(8666),s=r(6483),l=r(3520),c=r(604),u=r(2187),m=r(1255),d=r(5767),f=r(1387),p=r(184),h=new m.Vector3,g=new m.Vector3(0,1,0),j=new m.Quaternion,x=new m.Vector3;function b(e){var t=e.props,r=o.useContext(u.h),m=(0,i.Z)(r,2),b=m[0],_=m[1],v=b.forward,I=b.backward,C=b.left,P=b.right,y=b.jump,k=b.room,w=b.yrotate,M=(0,o.useRef)(),z=(0,o.useRef)(),R=(0,o.useRef)(),A=(0,o.useRef)(),K=(0,c.z)().camera,S={Home:[-10,2,10],Hall:[0,3,1],FrontYard:[-9,2,2],Bedroom:[4,3,0],Terrace:[-4,6,1]},L=o.useState(S[k]),Z=(0,i.Z)(L,2),B=Z[0],D=Z[1],F=(0,a.L)("/assets/model/character.glb"),H=F.animations,E=F.nodes,O=F.materials,V=(0,s.v)(H,M).actions,T=function(e,t){var r=z.current.translation();K.position.x+=e,K.position.z+=t,x.x=r.x,x.z=r.z,x.y=r.y+2,A.current&&(A.current.target=x)};return o.useEffect((function(){T(-10,10)}),[K]),o.useEffect((function(){D(S[k])}),[k]),o.useEffect((function(){var e="";if(v||I||C||P?(console.log("walk"),e="walking"):y?(console.log("jump"),e="jump"):(console.log("idle"),e="idle"),R.current!=e){console.log(e);var t=V[e],r=V[R.current];null===r||void 0===r||r.fadeOut(.2),null===t||void 0===t||t.reset().fadeIn(.2).play(),R.current=e}}),[v,I,C,P,y]),(0,c.A)((function(e,t){if(v||I||C||P){var r=z.current.translation(),n=Math.atan2(K.position.x-r.x,K.position.z-r.z),i=function(e){var t=e.forward,r=e.backward,n=e.left,i=e.right,o=0;return t?n?o=Math.PI/4:i&&(o=-Math.PI/4):r?o=n?Math.PI/4+Math.PI/2:i?-Math.PI/4-Math.PI/2:Math.PI:n?o=Math.PI/2:i&&(o=-Math.PI/2),o}({forward:v,backward:I,left:C,right:P});j.setFromAxisAngle(g,n+i),z.current.setRotation(j,!0),K.getWorldDirection(h),h.normalize().applyAxisAngle(g,i);var o=5*h.x*t,a=5*h.z*t;z.current.setTranslation({x:r.x+o,y:r.y,z:r.z+a},!0),T(o,a)}else T(0,0)})),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(l.z,{ref:A,rotateSpeed:.2,minDistance:.5,maxDistance:2.5,minPolarAngle:!0===v||!0===I||!0===C||!0===P?(0,d.b)(95):(0,d.b)(50),maxPolarAngle:!0===v||!0===I||!0===C||!0===P?(0,d.b)(95):(0,d.b)(150),zoomSpeed:.5,enablePan:!1,enableRotate:!0!==I&&!0!==C&&!0!==P,enableDamping:!0}),(0,p.jsxs)(f.ib,{ref:z,colliders:!1,mass:60,type:"dynamic",enabledRotations:[!1,!1,!1],position:B,canSleep:!1,enableCcd:!0,linearDamping:2,onCollisionEnter:function(e){var t,r,i;null!==(t=e.rigidBodyObject)&&void 0!==t&&null!==(r=t.children[0])&&void 0!==r&&null!==(i=r.name)&&void 0!==i&&i.startsWith("coin")&&1==e.rigidBodyObject.visible&&(e.rigidBodyObject.visible=!1,_((function(e){return(0,n.Z)((0,n.Z)({},e),{},{yrotate:w+1})})))},children:[(0,p.jsx)(f.zm,{args:[0,.4]}),(0,p.jsx)("group",(0,n.Z)((0,n.Z)({ref:M},t),{},{dispose:null,children:(0,p.jsx)("group",{name:"Scene",children:(0,p.jsxs)("group",{name:"Armature",rotation:[Math.PI,0,Math.PI],children:[(0,p.jsx)("primitive",{object:E.mixamorigHips}),(0,p.jsx)("primitive",{object:E.Ctrl_Master}),(0,p.jsx)("primitive",{object:E.Ctrl_ArmPole_IK_Left}),(0,p.jsx)("primitive",{object:E.Ctrl_Hand_IK_Left}),(0,p.jsx)("primitive",{object:E.Ctrl_ArmPole_IK_Right}),(0,p.jsx)("primitive",{object:E.Ctrl_Hand_IK_Right}),(0,p.jsx)("primitive",{object:E.Ctrl_Foot_IK_Left}),(0,p.jsx)("primitive",{object:E.Ctrl_LegPole_IK_Left}),(0,p.jsx)("primitive",{object:E.Ctrl_Foot_IK_Right}),(0,p.jsx)("primitive",{object:E.Ctrl_LegPole_IK_Right}),(0,p.jsx)("skinnedMesh",{name:"Ch42_Sneakers",geometry:E.Ch42_Sneakers.geometry,material:O.Ch42_Body,skeleton:E.Ch42_Sneakers.skeleton})]})})}))]})]})}}}]);
//# sourceMappingURL=559.2ef96295.chunk.js.map